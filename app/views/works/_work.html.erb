<%
   # exclude edited work from whole works list on work edit page
   unless work == @work
%>
    <tr class="activity">
      <td class="activity_start" name="<%= get_name_for_timeline work.from%>"><%= get_time_part work.from  %> </td>
      <td class="activity_end" name="<%= get_name_for_timeline work.to%>"><%= get_time_part work.to  %> </td>
      <td><%= humanize_duration work.duration %></td>
      <td class="activity_description"><%= work.description %> </td>
      <td>
        <% for category in work.categories %>
            <span class="label"><%= category.name %></span>
        <% end  %>
      </td>
      <td><%= link_to "edit", edit_work_path(work), :class=>"btn btn-mini" %></td>
      <td><%= link_to "delete", work, :method => :delete, :confirm => "You sure?", :title => work.description, :class=>"btn btn-mini btn-danger" %></td>
      <td>
        <div class="btn-group">
          <button class="btn btn-info btn-mini dropdown-toggle" data-toggle="dropdown">
            Actions
            <span class="caret"></span>
          </button>
          <ul class="dropdown-menu" style="min-width: 100px;">
            <li>
              <%= link_to "Add source", source_path(current_user, :work_id => work), :class => "btn-mini" %>
            </li>
            <li>
              <%= link_to "Create routine", '#', :class => "btn-mini"  %>
            </li>
          </ul>
        </div>
      </td>
    </tr>
<% end %>

<script type="text/javascript">
    $(document).ready( buildTimeline() );

    function buildTimeline () {
        // get first work line
        $("tr.activity").each( function(){
            // get start and finish IDs
            start = $("td.activity_start", this).attr("name")
            finish = $("td.activity_end", this).attr("name");

            // change color for activity start block
            tooltip_text = getTimeFromId(start) + ' - ' + getTimeFromId(finish) + ' ' +$("td.activity_description", this).html();

            while (start < finish)
            {
                // change color of filled interval
                $("#"+start).css("background-color", "green");

                // chage tool tip text
                $("#"+start).attr("data-original-title", tooltip_text) ;

                start++;
            }
         });
    }

    function getTimeFromId( min ){
        //min = $(this).attr("id");
        if( min >= 60) {
            time = (
                    Math.floor(min/60)<10
                            ? '0'+Math.floor(min/60)
                            : Math.floor(min/60)
                    )
                    + ':'
                    + (
                    min%60 == 0
                            ? '00'
                            : min%60
                    );
        }else{
            time = '00:' + (
                    min==0
                            ? '00'
                            : min
                    );
        }

        return time
    }

</script>